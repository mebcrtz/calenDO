{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>calenDO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{% static 'css/style.css' %}" rel="stylesheet">
</head>
<body>
    {% include 'partials/navbar.html' %}
    <main class="container-fluid">
        {% block content %}{% endblock %}
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const editButtons = document.querySelectorAll('.edit-item-button');

            editButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const itemId = this.dataset.itemId;
                    const itemName = this.dataset.itemName;
                    const itemType = this.dataset.itemType;
                    const itemNotes = this.dataset.itemNotes;
                    const scheduleName = "{{ schedule.slug }}"; // Use the current schedule's slug

                    // Populate form fields
                    document.getElementById('editItemId').value = itemId;
                    document.getElementById('editItemName').value = itemName;
                    document.getElementById(itemType === 'event' ? 'editEvent' : 'editClass').checked = true;
                    document.getElementById('editNotes').value = itemNotes;

                    // Set form action dynamically
                    document.getElementById('editItemForm').action = `/schedule/${scheduleName}/item/${itemId}/update/`;
                });
            });
        });
    </script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const editButtons = document.querySelectorAll('.edit-item-button');

        editButtons.forEach(button => {
            button.addEventListener('click', function () {
                // Extract item details
                const itemId = this.dataset.itemId;
                const itemName = this.dataset.itemName;
                const itemType = this.dataset.itemType;
                const itemNotes = this.dataset.itemNotes;
                const occurrences = JSON.parse(this.dataset.occurrences);

                // Populate the modal fields
                document.getElementById('editItemDetailsId').value = itemId;
                document.getElementById('editItemName').value = itemName;
                document.getElementById('editItemType').value = itemType;
                document.getElementById('editItemNotes').value = itemNotes;

                // Clear previous occurrences
                const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
                days.forEach(day => {
                    const checkbox = document.getElementById(`day${day}`);
                    if (checkbox) checkbox.checked = false;
                });

                // Populate occurrences
                if (occurrences.length > 0) {
                    const occurrence = occurrences[0]; // Assuming one occurrence for now
                    occurrence.days.forEach(day => {
                        const checkbox = document.getElementById(`day${day}`);
                        if (checkbox) checkbox.checked = true;
                    });
                    document.getElementById('startTime').value = occurrence.start_time; // Ensure time format is HH:mm
                    document.getElementById('endTime').value = occurrence.end_time;   // Ensure time format is HH:mm
                }

                // Show the modal
                const editItemDetailsModal = new bootstrap.Modal(document.getElementById('editItemDetailsModal'));
                editItemDetailsModal.show();
                console.log(occurrences);
            });
        });
    });
</script>


    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const selectButtons = document.querySelectorAll('.select-remove-item');
            const removeForm = document.getElementById('removeItemForm');
            const itemToRemoveName = document.getElementById('itemToRemoveName');
    
            selectButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const itemId = button.getAttribute('data-item-id');
                    const itemName = button.getAttribute('data-item-name');
                    
                    // Update the confirmation modal
                    itemToRemoveName.textContent = itemName;
    
                    // Update the form action
                    const actionUrl = `{% url 'remove_schedule_item' 0 %}`.replace('0', itemId);
                    removeForm.setAttribute('action', actionUrl);
                });
            });
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const deleteButtons = document.querySelectorAll('.delete-schedule-button');
            const deleteForm = document.getElementById('deleteScheduleForm');
            const scheduleNameField = document.getElementById('scheduleToDeleteName');

            deleteButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const scheduleSlug = button.getAttribute('data-schedule-slug'); // Get the schedule's slug
                    const scheduleName = button.getAttribute('data-schedule-name'); // Get the schedule's name

                    // Update modal content
                    scheduleNameField.textContent = scheduleName;

                    // Update form action
                    deleteForm.setAttribute('action', `/calendar/${scheduleSlug}/delete/`);
                });
            });
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const exportOptions = document.querySelectorAll('.export-option');

            exportOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const fileType = option.getAttribute('data-file-type');
                    const scheduleSlug = "{{ schedule.slug }}"; // Get the current schedule slug dynamically
                    const exportUrl = `/calendar/${scheduleSlug}/export/${fileType}/`;
                    window.location.href = exportUrl; // Redirect to the export URL
                });
            });
        });
    </script>
</body>
</html>
